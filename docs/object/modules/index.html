<!doctype html><html><head><link rel=stylesheet href=https://machengine.org/layouts/default.bb15466819d3fbaf312db7ece8726d7131ba9ed50eeb5e347de909b3f0b89c48.css><link rel=apple-touch-icon sizes=180x180 href=https://machengine.org//apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://machengine.org//favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://machengine.org//favicon-16x16.png><link rel=manifest href=https://machengine.org//site.webmanifest><link rel=mask-icon href=https://machengine.org//safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://machengine.org//assets/font/stylesheet.css><link rel=stylesheet href=https://machengine.org//assets/font/inter/inter.css><script async defer data-domain=hexops.com src=https://machengine.org//opendata.js></script><meta charset=utf-8><title>Object system: modules | Mach: zig game engine & graphics toolkit</title><link rel=canonical href=https://machengine.org/docs/object/modules/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Object system: modules"><meta property="og:description" content="Mach modules are the 'building blocks' used to organize everything in Mach itself, as well as in your own application."><meta property="og:type" content="article"><meta property="og:url" content="https://machengine.org/docs/object/modules/"><meta property="og:image" content="https://machengine.org/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_f363038d50344398b54fe05e9adad3e6.png"><meta property="article:section" content="docs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://machengine.org/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_f363038d50344398b54fe05e9adad3e6.png"><meta name=twitter:title content="Object system: modules"><meta name=twitter:description content="Mach modules are the 'building blocks' used to organize everything in Mach itself, as well as in your own application."></head><body><div class=navbar><div class=content><a href=https://machengine.org// class=logo><div class=img></div></a><div class=subsection><a href=https://machengine.org//docs class=item>Docs</a>
<a href=https://machengine.org//about class=item>Project</a></div><div class="divider color-border">&nbsp;</div><div class=subsection><a href=https://devlog.hexops.com/categories/mach/ class=item>Devlog</a>
<a href=https://github.com/hexops/mach class=svg-item><img alt=GitHub class=svg-icon src=https://machengine.org//img/github.svg></a>
<a href=https://discord.gg/XNG3NZgCqp class=svg-item><img alt=Discord class=svg-icon src=https://machengine.org//img/discord.svg></a>
<a href=https://github.com/sponsors/emidoots class=donate-button><img alt=Heart class=svg-icon src=https://machengine.org//img/heart.svg>
&nbsp;Donate</a></div></div></div><div id=content><link rel=stylesheet href=https://machengine.org/layouts/docs.145a7d0caf5b3345083bed4fb10383d5bbda5c3cfd5a83cc7a153b0afbd8b2eb.css><main aria-role=main class=main-docs><aside><ul><li><a href=https://machengine.org/docs><span>Overview</span></a></li><li><a href=https://machengine.org/docs/getting-started><span>Getting started</span></a></li><li><h3><span>Object system</span></h3></li><ul class=sub-menu><li><a href=https://machengine.org/docs/object>Overview</a></li><li><a href=https://machengine.org/docs/object/modules>Modules</a></li><li><a href=https://machengine.org/docs/object/systems>Systems</a></li><li><a href=https://machengine.org/docs/object/objects>Objects</a></li><li><a href=https://machengine.org/docs/object/relations>Relations</a></li></ul><li><h3><span>Math</span></h3></li><ul class=sub-menu><li><a href=https://machengine.org/docs/math>Overview</a></li><li><a href=https://machengine.org/docs/math/coordinate-system>Coordinate system</a></li><li><a href=https://machengine.org/docs/math/traversing-coordinate-systems>Traversing coordinate systems</a></li><li><a href=https://machengine.org/docs/math/matrix-storage>Matrix storage</a></li></ul><li><h3><span>GPU</span></h3></li><ul class=sub-menu><li><a href=https://machengine.org/docs/gpu>Overview</a></li><li><a href=https://machengine.org/docs/gpu/memory>Memory management</a></li><li><a href=https://machengine.org/docs/gpu/errors>Error handling</a></li></ul><li><h3><span>General</span></h3></li><ul class=sub-menu><li><a href=https://machengine.org/docs/roadmap>Roadmap</a></li><li><a href=https://machengine.org/docs/modularity>Modularity</a></li><li><a href=https://machengine.org/docs/stdlib>Standard library</a></li><li><a href=https://machengine.org/docs/zig-version>Zig version</a></li><li><a href=https://machengine.org/docs/nominated-zig>Nominated Zig</a></li></ul></ul></aside><div class=docs><h1 id=object-system-modules>Object system: modules</h1><p>Mach modules are a key concept of <a href=../>the Mach object system</a>. Mach modules (not to be confused with Zig modules, although they are very similar) are the &lsquo;building blocks&rsquo; used to organize everything in Mach itself, as well as in your own application. You can pick and choose which modules your program uses, import third-party libraries that provide modules, etc.</p><p>Examples of modules: a physics engine, a 2D sprite renderer, a text renderer, a scene manager, your application&rsquo;s main logic, etc.</p><h2 id=program-entrypoint>Program entrypoint</h2><p>Normally, you might start writing an application by writing the bulk of your code inside your <code>main.zig</code> file&rsquo;s <code>pub fn main</code>.</p><p>In a Mach application, you may not write <code>main.zig</code> at all. Instead you may prefer to let Mach provide <code>main.zig</code> for you depending on the platform, so that it can provide a different version for desktop/mobile/etc that handles such differences.</p><p>If you were to write <code>main.zig</code> yourself, though, it would look something like this for a desktop app:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>const</span> std <span style=color:#f92672>=</span> @import(<span style=color:#e6db74>&#34;std&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> mach <span style=color:#f92672>=</span> @import(<span style=color:#e6db74>&#34;mach&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// The set of Mach modules our application may use.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> Modules <span style=color:#f92672>=</span> mach.Modules(.{
</span></span><span style=display:flex><span>    mach.Core,
</span></span><span style=display:flex><span>    @import(<span style=color:#e6db74>&#34;App.zig&#34;</span>),
</span></span><span style=display:flex><span>    @import(<span style=color:#e6db74>&#34;Renderer.zig&#34;</span>),
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> main() <span style=color:#f92672>!</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> allocator <span style=color:#f92672>=</span> std.heap.c_allocator;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Initialize the module system.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> mods<span style=color:#f92672>:</span> Modules <span style=color:#f92672>=</span> <span style=color:#66d9ef>undefined</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> mods.init(allocator);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Pass control to our App.zig module.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> app <span style=color:#f92672>=</span> mods.get(.app);
</span></span><span style=display:flex><span>    app.run(.main);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here you can see we declare a <code>Modules</code> type - the set of Mach modules that our application may use when it runs.</p><p><strong><em>All Mach modules in a program are known once the program starts</em></strong>, you can&rsquo;t e.g. add/remove/disable modules at runtime - once you register them, they&rsquo;re always there ready to be used - the only question is whether you do use them or not.</p><p>If you look closely, none of our application logic is written in this <code>main.zig</code> file either: instead we write our application logic inside <code>App.zig</code> - our very own Mach module - and <code>pub fn main</code> simply passes control to that module.</p><h2 id=the-simplest-mach-module>The simplest Mach module</h2><p>Just like a Zig module, a Mach module is simply a struct - often written as just a Zig code file. For example, here&rsquo;s an <code>App.zig</code> module:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>const</span> mach_module <span style=color:#f92672>=</span> .app;
</span></span></code></pre></div><p>This module doesn&rsquo;t do anything - it&rsquo;s just has a name - which is the only required field for a Mach module.</p><h2 id=modules-have-_names_>Modules have <em>names</em></h2><p>Modules follow certain conventions and requirements, the first one being that a module <em>must have a unique name</em>.</p><p>The <code>pub const mach_module = .foobar;</code> is an enum literal indicating the module&rsquo;s name (you can write any value on the right hand side, since you&rsquo;re <em>declaring</em> the module&rsquo;s name.)</p><p>Here are some naming rules and guidelines to be aware of:</p><ol><li>No two modules in a program can have the same name (enforced by a compiler error), which means <strong><em>all Mach modules in a program are globally addressible</em></strong>.</li><li>If writing a module that others may import/use in their own programs, you should prefix your module names with a unique identifier like your project name to prevent conflicts with the user&rsquo;s own application modules.<ul><li>Example: Mach&rsquo;s builtin modules are prefixed with &ldquo;mach_&rdquo;, e.g. <code>.mach_sprite_renderer</code> instead of <code>.sprite_renderer</code></li></ul></li><li>If writing a module just for your application/game&rsquo;s logic, you can safely assume all modules you import are prefixed - so you can use single-word names like <code>.app</code>, <code>.physics</code>, <code>.renderer</code>, etc. for yourself.</li></ol><h2 id=modules-can-have-_global-state_>Modules can have <em>global state</em></h2><p>Let&rsquo;s look at our <code>App.zig</code> module from earlier: since Zig code files are just structs (as if you wrote the contents of a file inside a <code>struct { ... }</code> block), we can write struct fields at the top level of our file.</p><p>For example, we can add a <code>timer</code> and <code>counter</code> field to our <code>App.zig</code> module:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>const</span> mach_module <span style=color:#f92672>=</span> .app;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>timer<span style=color:#f92672>:</span> mach.time.Timer,
</span></span><span style=display:flex><span>counter<span style=color:#f92672>:</span> <span style=color:#66d9ef>u32</span>,
</span></span></code></pre></div><p>There is only ever one <em>instance</em> of a module in a program, so these are <em>effectively</em> global variables. Writing these as <em>struct fields</em> rather than literally as global <code>var</code>s means that <strong><em>Mach moduloe&rsquo;s global state fields are globally addressible</em></strong> (its possible to walk <em>all modules used in the program</em>, then walk over <em>all their state fields</em>, inspecting their data types, and reading/writing their values at runtime - which is super useful for debug tooling and more!)</p><h2 id=modules-can-have-_systems_>Modules can have <em>systems</em></h2><p>Similar to how we declared <code>pub const mach_module = .foo_name;</code>, a module can declare that it has <em>systems</em> with specific names:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>const</span> mach_systems <span style=color:#f92672>=</span> .{ .main, .init, .tick, .deinit };
</span></span></code></pre></div><p>In this case, our module declared that it has systems called <code>.main</code>, <code>.init</code>, <code>.tick</code>, and <code>.deinit</code> - these are just made up names (we&rsquo;re <em>declaring them</em>) - we can name them whatever we like.</p><p>Systems are ultimately just functions (or lists of functions) that <em>could</em> be run if someone wants them to. They don&rsquo;t do anything by default.</p><p>The only requirement is that if a system is named in <code>mach_systems</code>, there must be a corresponding public function or schedule of the same name (else you&rsquo;ll get a compiler error) - for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> init() <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>Systems are covered in more depth in <a href=../systems>the systems section</a>.</p><h2 id=modules-can-have-_objects_>Modules can have <em>objects</em></h2><p>Just like how we added the <code>timer</code> and <code>counter</code> fields above, it is possible to declare <em>lists of objects</em> inside a module. For example, here&rsquo;s a list of <code>monsters</code> where each monster object can have a <code>health</code> and <code>damage</code> value:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span>monsters<span style=color:#f92672>:</span> mach.Objects(<span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>    health<span style=color:#f92672>:</span> <span style=color:#66d9ef>f32</span>,
</span></span><span style=display:flex><span>    damage<span style=color:#f92672>:</span> <span style=color:#66d9ef>f32</span>,
</span></span><span style=display:flex><span>}),
</span></span></code></pre></div><p>Objects are covered in more depth in <a href=../objects>the objects section</a>.</p><h2 id=continue-reading-systems>Continue reading: systems</h2><p><a href=../systems>Object system: systems</a></p></div><div class=toc><h3>Table of contents</h3><nav id=TableOfContents><ul><li><a href=#program-entrypoint>Program entrypoint</a></li><li><a href=#the-simplest-mach-module>The simplest Mach module</a></li><li><a href=#modules-have-_names_>Modules have <em>names</em></a></li><li><a href=#modules-can-have-_global-state_>Modules can have <em>global state</em></a></li><li><a href=#modules-can-have-_systems_>Modules can have <em>systems</em></a></li><li><a href=#modules-can-have-_objects_>Modules can have <em>objects</em></a></li><li><a href=#continue-reading-systems>Continue reading: systems</a></li></ul></nav></div></main><div class=footer><a href=https://hexops.com/privacy>Privacy matters</a><p><a href=https://github.com/hexops/machengine.org/archive/refs/heads/gh-pages.zip>offline version of this site</a> | <a href=https://machengine.org//about#improve-this-site>Improve this site</a> | <a href=https://github.com/sponsors/emidoots>Sponsor on GitHub</a> | <a href=https://devlog.hexops.com/>Hexops' devlog</a></p></div></div></body></html>