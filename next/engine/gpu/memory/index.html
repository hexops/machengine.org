<!doctype html><html><head><link rel=stylesheet href=https://machengine.org/next/layouts/default.9af34c83dd334eeaf345e328c050f5d9a522354e2a594ab12f46bd2032529363.css><link rel=apple-touch-icon sizes=180x180 href=https://machengine.org/next/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://machengine.org/next/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://machengine.org/next/favicon-16x16.png><link rel=manifest href=https://machengine.org/next/site.webmanifest><link rel=mask-icon href=https://machengine.org/next/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://machengine.org/next/assets/font/stylesheet.css><link rel=stylesheet href=https://machengine.org/next/assets/font/inter/inter.css><script async defer data-domain=hexops.com src=https://machengine.org/next/opendata.js></script><meta charset=utf-8><title>GPU memory management | Mach: zig game engine & graphics toolkit</title><link rel=canonical href=https://machengine.org/next/engine/gpu/memory/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noindex"><meta property="og:title" content="GPU memory management"><meta property="og:description" content="Explains GPU memory management, alignment requirements, etc."><meta property="og:type" content="article"><meta property="og:url" content="https://machengine.org/next/engine/gpu/memory/"><meta property="og:image" content="https://machengine.org/next/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_da9f417c92bf5096f1859d121e622ca9.png"><meta property="article:section" content="engine"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://machengine.org/next/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_da9f417c92bf5096f1859d121e622ca9.png"><meta name=twitter:title content="GPU memory management"><meta name=twitter:description content="Explains GPU memory management, alignment requirements, etc."></head><body><div class=navbar><div class=content><a href=https://machengine.org/next/ class=logo><div class=img></div></a><div><a href=https://machengine.org/next/engine class=item>Engine</a>
<a href=https://machengine.org/next/core class=item>Core</a>
<a href=https://machengine.org/next/pkg class=item>Packages</a>
<a href=https://machengine.org/next/about class=item>Project</a><div style="width:0;height:100%;border-left:1px solid" class=color-border>&nbsp;</div><a href=https://devlog.hexops.com/categories/mach/ class=item>Devlog</a>
<a href=https://github.com/hexops/mach class=svg-item><img alt=GitHub class=svg-icon src=https://machengine.org/next/img/github.svg></a>
<a href=https://discord.gg/XNG3NZgCqp class=svg-item><img alt=Discord class=svg-icon src=https://machengine.org/next/img/discord.svg></a>
<a href=https://github.com/sponsors/slimsag class=donate-button><img alt=Heart class=svg-icon src=https://machengine.org/next/img/heart.svg>
&nbsp;Donate</a></div></div></div><div class="alert warning"><span><strong>HEY YOU!</strong> We're still working on this site, please don't share it in very public places :)</span></div><div id=content><link rel=stylesheet href=https://machengine.org/next/layouts/docs.a2978d86fe897d36c7156a89344e1c3c64909c3c94fc570946c0ca9508158892.css><main aria-role=main class=main-docs><aside><ul><li><a href=https://machengine.org/next/engine><span>Engine overview</span></a></li><li><a href=https://machengine.org/next/about/known-issues><span>Known issues â®•</span></a></li><li><h3><span>Math</span></h3></li><ul class=sub-menu><li><a href=https://machengine.org/next/engine/math>Overview</a></li><li><a href=https://machengine.org/next/engine/math/coordinate-system>Coordinate system</a></li><li><a href=https://machengine.org/next/engine/math/matrix-storage>Matrix storage</a></li></ul><li><h3><span>GPU</span></h3></li><ul class=sub-menu><li><a href=https://machengine.org/next/engine/gpu>Overview</a></li><li><a href=https://machengine.org/next/engine/gpu/memory>Memory management</a></li><li><a href=https://machengine.org/next/engine/gpu/errors>Error handling</a></li></ul></ul></aside><div class=docs><h1 id=gpu-memory-management>GPU memory management</h1><h2 id=reference-counting>Reference counting</h2><p>GPU objects like <code>gpu.Texture</code>, <code>gpu.Buffer</code>, or any other object which has a <code>.reference</code>, <code>.release</code> and <code>.destroy</code> method - use reference counting.</p><p>Although we love explicit memory management, GPU memory is perhaps <em>one of the best use-cases for reference counting.</em> All WebGPU objects are reference counted, and it&rsquo;s not just because it originated as a browser API.</p><h3 id=guidance>Guidance</h3><p>Use <code>.reference()</code> and <code>.release()</code> to release memory of objects. When the reference count reaches zero, <code>.destroy()</code> will be called automatically for you.</p><p>Use-after-free is possible (e.g. passing a texture whose reference count has reached 0 into an API.)</p><p>In the browser, <code>.reference()</code> and <code>.release()</code> are managed by the JavaScript garbage collector - and as a result, an additional <code>.destroy()</code> option is provided which lets you explicitly request an object be freed, so you can get GPU memory back without being at the mercy of the JS garbage collector. Whenever the reference count reaches zero, <code>.destroy()</code> is automatically called for you.</p><h2 id=memory-alignment>Memory alignment</h2><p>GPUs and underlying graphics APIs have unique memory alignment requirements:</p><ul><li>Uniforms: 16-byte alignment</li><li>Buffer uploads: any alignment</li><li>Buffer uploads with an offset: 256-byte alignment</li><li>WGSL accesses of e.g. buffer struct fields: any alignment</li><li>Buffer downloads (calls to <code>getMappedRange(T, ...)</code>) return pointers from the underlying GPU API, generally it is required that <code>@alignOf(T) == 16</code>. See also <a href=https://github.com/hexops/mach/issues/847>hexops/mach#847</a> and <a href=https://github.com/webgpu-native/webgpu-headers/issues/180>webgpu-headers#180</a>.</li></ul></div><div class=toc><h3>Table of contents</h3><nav id=TableOfContents><ul><li><a href=#reference-counting>Reference counting</a><ul><li><a href=#guidance>Guidance</a></li></ul></li><li><a href=#memory-alignment>Memory alignment</a></li></ul></nav></div></main><div class=footer><a href=https://hexops.com/privacy>Privacy matters</a><p><a href=https://machengine.org/next/about#improve-this-site>Improve this site</a> | <a href=https://github.com/sponsors/slimsag>Sponsor on GitHub</a> | <a href=https://devlog.hexops.com/>Hexops' devlog</a></p></div></div></body></html>