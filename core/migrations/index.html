<!doctype html><html><head><link rel=stylesheet href=https://machengine.org/layouts/default.1b9540ff392b51b0b809690caf746c7ec39a7048990a55170087510406bf5e62.css><link rel=apple-touch-icon sizes=180x180 href=https://machengine.org//apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://machengine.org//favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://machengine.org//favicon-16x16.png><link rel=manifest href=https://machengine.org//site.webmanifest><link rel=mask-icon href=https://machengine.org//safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://machengine.org//assets/font/stylesheet.css><link rel=stylesheet href=https://machengine.org//assets/font/inter/inter.css><script async defer data-domain=hexops.com src=https://machengine.org//opendata.js></script><meta charset=utf-8><title>Mach: zig game engine & graphics toolkit</title><link rel=canonical href=https://machengine.org/core/migrations/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Migration notes"><meta property="og:description" content="In the event of a breaking change, this page details any migration steps neccessary to upgrade your code to the latest version of Mach core or one of our standalone libraries."><meta property="og:type" content="website"><meta property="og:url" content="https://machengine.org/core/migrations/"><meta property="og:image" content="https://machengine.org/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_464206f0f1467ac30d053bf32df15547.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://machengine.org/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_464206f0f1467ac30d053bf32df15547.png"><meta name=twitter:title content="Migration notes"><meta name=twitter:description content="In the event of a breaking change, this page details any migration steps neccessary to upgrade your code to the latest version of Mach core or one of our standalone libraries."></head><body><div class=navbar><div class=content><a href=https://machengine.org// class=logo><div class=img></div></a><div class=subsection><a href=https://machengine.org//engine class=item>Engine</a>
<a href=https://machengine.org//core class=item>Core</a>
<a href=https://machengine.org//pkg class=item>Packages</a>
<a href=https://machengine.org//about class=item>Project</a></div><div class="divider color-border">&nbsp;</div><div class=subsection><a href=https://devlog.hexops.com/categories/mach/ class=item>Devlog</a>
<a href=https://github.com/hexops/mach class=svg-item><img alt=GitHub class=svg-icon src=https://machengine.org//img/github.svg></a>
<a href=https://discord.gg/XNG3NZgCqp class=svg-item><img alt=Discord class=svg-icon src=https://machengine.org//img/discord.svg></a>
<a href=https://github.com/sponsors/slimsag class=donate-button><img alt=Heart class=svg-icon src=https://machengine.org//img/heart.svg>
&nbsp;Donate</a></div></div></div><div class=alert><span><strong>Mach v0.2 has been released!</strong> For all the details check out <a href=https://devlog.hexops.com/2023/mach-v0.2-released/>the announcement</a></span></div><div id=content><link rel=stylesheet href=https://machengine.org/layouts/docs.1c549ac5e9eaa1dc4997cd957caa9afec046a45d465b64074e1ec4f88737dd7b.css><main aria-role=main class="main-docs with-alert"><aside><ul><li><a href=https://machengine.org/core><span>Core overview</span></a></li><li><a href=https://machengine.org/core/examples><span>Examples</span></a></li><li><a href=https://machengine.org/core/getting-started><span>Getting started</span></a></li><li><a href=https://machengine.org/core/migrations><span>Migrations</span></a></li><li><a href=https://machengine.org/about/known-issues><span>Known issues â®•</span></a></li></ul></aside><div class=docs><h1 id=migration-notes>Migration notes</h1><p>To learn more about Mach&rsquo;s library stability guarantees, check out the <a href=../../pkg>libraries overview</a> page. This page provides migration guides for Mach libraries-walking you through how to update your code to the latest version.</p><h2 id=mach-core-zig-version-update-2023-10-17>mach-core: Zig version update (2023-10-17)</h2><p>Mach core <a href=https://github.com/hexops/mach-core/tree/331ce61cb8c075be6d7c46e49da8ccbd5967d9b7>967d9b7</a> and above now uses Zig version <a href=https://machengine.org/about/zig-version/><code>0.12.0-dev.978+78855bd21</code></a>.</p><p>To update your mach-core project, <a href=https://github.com/hexops/mach-core-starter-project/commit/b079bfb4e080f4c429f468a0c7f636608737346c>follow this diff</a>.</p><h2 id=mach-core-build-api-improvements-2023-09-24>mach-core: build API improvements (2023-09-24)</h2><p>Imports now have a <code>mach-</code> prefix:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-diff data-lang=diff><span style=display:flex><span><span style=color:#f92672>-const core = @import(&#34;core&#34;);
</span></span></span><span style=display:flex><span><span style=color:#f92672></span><span style=color:#a6e22e>+const core = @import(&#34;mach-core&#34;);
</span></span></span></code></pre></div><p>The <code>module()</code> helper (you likely do not use this) has been replaced with a proper Zig module accessible via <code>b.dependency("mach_core", .{...}).module("mach-core")</code></p><h2 id=mach-core-build-api-improvements-2023-09-17>mach-core: build API improvements (2023-09-17)</h2><p>Zig <code>0.12.0-dev.389+61b70778b</code> is now in use (previously <code>0.12.0-dev.21+ac95cfe44</code>); and your <code>build.zig.zon</code> file no longer needs to specify transitive dependencies, and the <code>build.zig</code> API has changed slightly:</p><ul><li><a href=https://github.com/hexops/mach-core-starter-project/commit/1bab9664f78eec5e71005fc0e341625a23995201>mach-core changes diff</a></li><li><a href=https://github.com/hexops/machengine.org/commit/0a8723ea2be0f109348713e689467f0bf8786429>Other packages diff</a></li></ul><h2 id=mach-core-api-design-changes-2023-08-07>mach-core: API design changes (2023-08-07)</h2><h3 id=printtitle>printTitle</h3><p>Instead of writing e.g. this before:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>const</span> title <span style=color:#f92672>=</span> <span style=color:#66d9ef>try</span> std.fmt.bufPrintZ(<span style=color:#f92672>&amp;</span>core.title, <span style=color:#e6db74>&#34;Sprite2D [ FPS: {d} ]&#34;</span>, .{@floor(<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> delta_time)});
</span></span><span style=display:flex><span>core.setTitle(title);
</span></span></code></pre></div><p>It is now possible to write just:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>try</span> core.printTitle(<span style=color:#e6db74>&#34;Sprite2D [ FPS: {d} ]&#34;</span>, .{@floor(<span style=color:#ae81ff>1</span> <span style=color:#f92672>/</span> delta_time)});
</span></span></code></pre></div><h3 id=delta-time-frame-rate>Delta time, frame rate</h3><p>Internal timers now provide reasonable default methods of measuring frame rate, input rate, and frame delta time.</p><ul><li><code>core.frameRate()</code></li><li><code>core.inputRate()</code></li><li><code>core.delta_time</code> (f32 seconds)</li><li><code>core.delta_time_ns</code> (u64 nanoseconds)</li></ul><h3 id=machcore-is-now-a-global>mach.Core is now a global</h3><ul><li>Your <code>App</code> struct no longer needs to have a field <code>core: mach.Core,</code> (before it was required, and the name MUST be <code>core</code>)</li><li>APIs that were accessible through a <code>*Core</code> instance before, e.g. <code>app.core.frameRate()</code>, are now accessible as global methods. e.g. <code>@import("core").frameRate()</code></li><li><code>core.init</code> no longer needs an allocator, instead <code>core.allocator</code> is used - which you can change at any point before calling <code>core.init()</code></li></ul><h4 id=before>Before</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>const</span> App <span style=color:#f92672>=</span> @This();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> gpa <span style=color:#f92672>=</span> std.heap.GeneralPurposeAllocator(.{}){};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>core<span style=color:#f92672>:</span> mach.Core,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> init(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#f92672>!</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> app.core.init(gpa.allocator(), .{});
</span></span><span style=display:flex><span>    app.<span style=color:#f92672>*</span> <span style=color:#f92672>=</span> .{
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> deinit(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> _ <span style=color:#f92672>=</span> gpa.deinit();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> app.core.deinit();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> update(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#f92672>!</span><span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=after>After</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>const</span> App <span style=color:#f92672>=</span> @This();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> init(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#f92672>!</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> core.init(.{});
</span></span><span style=display:flex><span>    app.<span style=color:#f92672>*</span> <span style=color:#f92672>=</span> .{
</span></span><span style=display:flex><span>        <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> deinit(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> core.deinit();
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> update(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#f92672>!</span><span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=custom-entrypoints>Custom entrypoints</h3><p>It&rsquo;s now easier than ever to write a custom entrypoint for your application (e.g. <code>pub fn main</code>) if you really want/need to:</p><ul><li>WASM: <a href=https://github.com/hexops/mach-core/blob/7a3d7e469dfc3893acbca163be79ed426c634317/src/platform/wasm/main.zig>42 lines of code</a></li><li>desktop: <a href=https://github.com/hexops/mach-core/blob/7a3d7e469dfc3893acbca163be79ed426c634317/src/platform/native/main.zig>33 lines of code</a></li></ul><h3 id=fields-instead-of-getters>Fields instead of getters</h3><p>A few getters have been turned into fields instead:</p><ul><li><code>core.device()</code> -> <code>core.device</code></li><li><code>core.device().getQueue()</code> -> <code>core.queue</code></li><li><code>core.descriptor()</code> -> <code>core.descriptor</code></li><li><code>core.adapter()</code> -> <code>core.adapter</code></li><li><code>core.swapChain()</code> -> <code>core.swap_chain</code></li></ul><h2 id=mach-core-build-system-changes>mach-core: build system changes</h2><p>The following fields/functions from <code>mach.App</code> in <code>build.zig</code> have been removed:</p><ul><li><code>.step</code></li><li><code>.install()</code></li><li><code>.addRunArtifact()</code></li><li><code>.getInstallStep()</code></li><li><code>.link(.{ .gpu_dawn_options = .{} })</code></li></ul><p>The following have been added:</p><ul><li><code>.compile.step</code></li><li><code>.install.step</code></li><li><code>.run.step</code></li><li><code>App.init(.{ .gpu_dawn_options = .{} })</code></li></ul><p>Suggested usage is now e.g.:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>const</span> app <span style=color:#f92672>=</span> <span style=color:#66d9ef>try</span> core.App.init(...);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> install_step <span style=color:#f92672>=</span> b.step(<span style=color:#e6db74>&#34;install&#34;</span>, <span style=color:#e6db74>&#34;Install &#34;</span> <span style=color:#f92672>++</span> example.name);
</span></span><span style=display:flex><span>install_step.dependOn(<span style=color:#f92672>&amp;</span>app.install.step);
</span></span><span style=display:flex><span>b.getInstallStep().dependOn(install_step);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> run_step <span style=color:#f92672>=</span> b.step(<span style=color:#e6db74>&#34;run&#34;</span>, <span style=color:#e6db74>&#34;Run &#34;</span> <span style=color:#f92672>++</span> example.name);
</span></span><span style=display:flex><span>run_step.dependOn(<span style=color:#f92672>&amp;</span>app.run.step);
</span></span></code></pre></div><p>It is also possible to add a &lsquo;compile only&rsquo; step now, for e.g. checking code merely builds should you want to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>const</span> compile_step <span style=color:#f92672>=</span> b.step(<span style=color:#e6db74>&#34;compile&#34;</span>, <span style=color:#e6db74>&#34;Install &#34;</span> <span style=color:#f92672>++</span> example.name);
</span></span><span style=display:flex><span>compile_step.dependOn(<span style=color:#f92672>&amp;</span>app.compile.step);
</span></span></code></pre></div><h2 id=mach-core-multithreaded-rendering--standalone-usage>mach-core: multithreaded rendering & standalone usage</h2><p>mach-core is now available as a 100% standalone repository / Zig package. The <a href=../getting-started>getting started</a> documentation has been updated to reflect this.</p><p>Additionally, we have landed <a href=https://github.com/hexops/mach-core/pull/15>multi-threaded rendering support</a> which allows native applications to run at e.g. 60FPS while handling input events at 240hz. It also enables butter-smooth window resizing.</p><p>API changes:</p><ul><li><code>core.framebufferSize()</code> has been removed in favor of <code>core.descriptor().width</code> and <code>core.descriptor().height</code></li><li><code>App.init</code> and <code>App.deinit</code> are executed on the main thread, <code>App.update</code> is executed in a separate thread.</li><li>Input events are enqueued/bufferred, and you can poll them whenever you like (e.g. you may handle input mid-frame if you like.)</li><li><code>setWaitTimeout</code> / &ldquo;waiting&rdquo; APIs are being redesigned and are not yet functional. e.g. for the case of a desktop app that you rightfully want to be low-power, in this scenario you need a way to slow event polling of both the main thread and rendering thread - which is not yet possible.</li></ul><h2 id=mach-glfw-package-manager-usage>mach-glfw: package manager usage</h2><p>If you are a user of mach-glfw, note that we have adopted the experimental Zig package manager. It is not perfect yet and there are many papercuts; for details on how to update your codebase <a href=https://github.com/hexops/mach/issues/861#issuecomment-1638185447>please see this</a></p><h2 id=mach-core-v02-api-redesign>mach-core: v0.2 API redesign</h2><div class=subtext>2023-01-27 - affects all mach-core users</div><p>Mach v0.2 brings a complete redesign of the mach-core API. To upgrade your application see <a href=2023-core-api>the upgrade guide</a></p><h2 id=mach-glfw-error-handling-improvements>mach-glfw: error handling improvements</h2><div class=subtext>2023-01-10 - affects all mach-glfw users</div><p>We&rsquo;ve made another error handling improvement to the <code>mach-glfw</code> API:</p><ul><li><code>glfw.getError</code> has been renamed to <code>glfw.getErrorCode</code> (returns a Zig error type still)</li><li><code>glfw.getError</code> instead now returns a struct with <em>both</em> the error message and Zig error type.</li><li><code>glfw.clearError</code> has been added, a smaller helper to make writing <code>defer glfw.clearError()</code> nicer than before (<code>defer glfw.getErrorCode() catch {};</code>).</li></ul><ul><li><a href=https://github.com/hexops/mach/pull/668>More information</a></li></ul><h2 id=glfw-error-handling-changes>glfw: error handling changes</h2><div class=subtext>2023-01-08 - affects all mach-glfw users</div><p>We have completely overhauled the mach-glfw error handling approach to help users better avoid footguns and ultimately improve the ability of Zig GLFW applications to run on more obscure X11 window managers and Wayland in general.</p><ul><li><a href=https://github.com/hexops/mach/pull/662>More information</a></li><li>How to update: please see &ldquo;The solution&rdquo; in <a href=https://github.com/hexops/mach/pull/662>https://github.com/hexops/mach/pull/662</a></li></ul></div><div class=toc><h3>Table of contents</h3><nav id=TableOfContents><ul><li><a href=#mach-core-zig-version-update-2023-10-17>mach-core: Zig version update (2023-10-17)</a></li><li><a href=#mach-core-build-api-improvements-2023-09-24>mach-core: build API improvements (2023-09-24)</a></li><li><a href=#mach-core-build-api-improvements-2023-09-17>mach-core: build API improvements (2023-09-17)</a></li><li><a href=#mach-core-api-design-changes-2023-08-07>mach-core: API design changes (2023-08-07)</a><ul><li><a href=#printtitle>printTitle</a></li><li><a href=#delta-time-frame-rate>Delta time, frame rate</a></li><li><a href=#machcore-is-now-a-global>mach.Core is now a global</a></li><li><a href=#custom-entrypoints>Custom entrypoints</a></li><li><a href=#fields-instead-of-getters>Fields instead of getters</a></li></ul></li><li><a href=#mach-core-build-system-changes>mach-core: build system changes</a></li><li><a href=#mach-core-multithreaded-rendering--standalone-usage>mach-core: multithreaded rendering & standalone usage</a></li><li><a href=#mach-glfw-package-manager-usage>mach-glfw: package manager usage</a></li><li><a href=#mach-core-v02-api-redesign>mach-core: v0.2 API redesign</a></li><li><a href=#mach-glfw-error-handling-improvements>mach-glfw: error handling improvements</a></li><li><a href=#glfw-error-handling-changes>glfw: error handling changes</a></li></ul></nav></div></main><div class=footer><a href=https://hexops.com/privacy>Privacy matters</a><p><a href=https://github.com/hexops/machengine.org/archive/refs/heads/gh-pages.zip>offline version of this site</a> | <a href=https://machengine.org//about#improve-this-site>Improve this site</a> | <a href=https://github.com/sponsors/slimsag>Sponsor on GitHub</a> | <a href=https://devlog.hexops.com/>Hexops' devlog</a></p></div></div></body></html>