<!doctype html><html><head><link rel=stylesheet href=https://machengine.org/layouts/default.1b9540ff392b51b0b809690caf746c7ec39a7048990a55170087510406bf5e62.css><link rel=apple-touch-icon sizes=180x180 href=https://machengine.org//apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://machengine.org//favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://machengine.org//favicon-16x16.png><link rel=manifest href=https://machengine.org//site.webmanifest><link rel=mask-icon href=https://machengine.org//safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><link rel=stylesheet href=https://machengine.org//assets/font/stylesheet.css><link rel=stylesheet href=https://machengine.org//assets/font/inter/inter.css><script async defer data-domain=hexops.com src=https://machengine.org//opendata.js></script><meta charset=utf-8><title>Migration notes | Mach: zig game engine & graphics toolkit</title><link rel=canonical href=https://machengine.org/core/migrations/2023-core-api/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Migration notes"><meta property="og:description" content="In the event of a breaking change, this page details any migration steps neccessary to upgrade your code to the latest version of Mach core or one of our standalone libraries."><meta property="og:type" content="article"><meta property="og:url" content="https://machengine.org/core/migrations/2023-core-api/"><meta property="og:image" content="https://machengine.org/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_464206f0f1467ac30d053bf32df15547.png"><meta property="article:section" content="core"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://machengine.org/opengraph/template_hu102e162f47cb7d8ae9eb284939698b9d_62022_464206f0f1467ac30d053bf32df15547.png"><meta name=twitter:title content="Migration notes"><meta name=twitter:description content="In the event of a breaking change, this page details any migration steps neccessary to upgrade your code to the latest version of Mach core or one of our standalone libraries."></head><body><div class=navbar><div class=content><a href=https://machengine.org// class=logo><div class=img></div></a><div class=subsection><a href=https://machengine.org//engine class=item>Engine</a>
<a href=https://machengine.org//core class=item>Core</a>
<a href=https://machengine.org//pkg class=item>Packages</a>
<a href=https://machengine.org//about class=item>Project</a></div><div class="divider color-border">&nbsp;</div><div class=subsection><a href=https://devlog.hexops.com/categories/mach/ class=item>Devlog</a>
<a href=https://github.com/hexops/mach class=svg-item><img alt=GitHub class=svg-icon src=https://machengine.org//img/github.svg></a>
<a href=https://discord.gg/XNG3NZgCqp class=svg-item><img alt=Discord class=svg-icon src=https://machengine.org//img/discord.svg></a>
<a href=https://github.com/sponsors/slimsag class=donate-button><img alt=Heart class=svg-icon src=https://machengine.org//img/heart.svg>
&nbsp;Donate</a></div></div></div><div class=alert><span><strong>Mach v0.3 has been released!</strong> For all the details check out <a href=https://devlog.hexops.com/2023/mach-v0.2-released/>the announcement</a></span></div><div id=content><link rel=stylesheet href=https://machengine.org/layouts/docs.1c549ac5e9eaa1dc4997cd957caa9afec046a45d465b64074e1ec4f88737dd7b.css><main aria-role=main class="main-docs with-alert"><aside><ul><li><a href=https://machengine.org/core><span>Core overview</span></a></li><li><a href=https://machengine.org/core/examples><span>Examples</span></a></li><li><a href=https://machengine.org/core/getting-started><span>Getting started</span></a></li><li><a href=https://machengine.org/core/migrations><span>Migrations</span></a></li><li><a href=https://machengine.org/about/known-issues><span>Known issues â®•</span></a></li></ul></aside><div class=docs><h1 id=mach-core-v02-api-redesign>mach-core: v0.2 API redesign</h1><p>Mach v0.2 brought a complete redesign of the mach-core API. To upgrade your application, see the notes below.</p><p>See also the <a href=../>migration notes</a> page.</p><h2 id=updating-your-application>Updating your application</h2><p>Previously, a complete Mach Core application looked something like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>const</span> App <span style=color:#f92672>=</span> @This();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> init(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App, core<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>mach.Core) <span style=color:#f92672>!</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> deinit(_<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App, _<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>mach.Core) <span style=color:#66d9ef>void</span> {}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> update(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App, core<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>mach.Core) <span style=color:#f92672>!</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (core.pollEvent()) <span style=color:#f92672>|</span>event<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> (event) {
</span></span><span style=display:flex><span>            .key_press <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>|</span>ev<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (ev.key <span style=color:#f92672>==</span> .space) core.close();
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#f92672>=&gt;</span> {},
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// core.swap_chain_format
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    core.swap_chain.<span style=color:#f92672>?</span>.present();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// optional
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> resize(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App, core<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>mach.Core, width<span style=color:#f92672>:</span> <span style=color:#66d9ef>u32</span>, height<span style=color:#f92672>:</span> <span style=color:#66d9ef>u32</span>) <span style=color:#f92672>!</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// use core.device
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>After these changes, the above now looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-zig data-lang=zig><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>const</span> App <span style=color:#f92672>=</span> @This();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> gpa <span style=color:#f92672>=</span> std.heap.GeneralPurposeAllocator(.{}){};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>core<span style=color:#f92672>:</span> mach.Core,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> init(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#f92672>!</span><span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> allocator <span style=color:#f92672>=</span> gpa.allocator();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span> app.core.init(allocator, .{});
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> deinit(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#66d9ef>void</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> _ <span style=color:#f92672>=</span> gpa.deinit();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> app.core.deinit();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>pub</span> <span style=color:#66d9ef>fn</span> update(app<span style=color:#f92672>:</span> <span style=color:#f92672>*</span>App) <span style=color:#f92672>!</span><span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> iter <span style=color:#f92672>=</span> app.core.pollEvents();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> (iter.next()) <span style=color:#f92672>|</span>event<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>switch</span> (event) {
</span></span><span style=display:flex><span>            .key_press <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>|</span>ev<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (ev.key <span style=color:#f92672>==</span> .space) core.close();
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            .framebuffer_resize <span style=color:#f92672>=&gt;</span> <span style=color:#f92672>|</span>ev<span style=color:#f92672>|</span> {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// optional event - framebuffer resized to ev.width, ev.height
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// use app.core.device()
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            },
</span></span><span style=display:flex><span>            .close <span style=color:#f92672>=&gt;</span> <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>else</span> <span style=color:#f92672>=&gt;</span> {},
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>// core.swap_chain_format -&gt; core.descriptor().format
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    core.swapchain().present();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Notably:</p><ul><li><code>mach.Core</code> is no longer a parameter provided to your <code>App</code>, instead, Mach only calls <code>init</code>/<code>update</code>/<code>deinit</code> callbacks of your app, and you are responsible for maintaining a <code>mach.Core</code> instance and using it.</li><li>It is now possible to specify your own allocator for <code>mach.Core</code> to use.</li><li><code>core.pollEvent</code> has been renamed to <code>core.pollEvents</code> and now returns an iterator of events.</li><li><code>App.update</code> must now return <code>!bool</code> instead of <code>!void</code>, the bool indicates if the program should exit.</li><li><code>App.resize</code> is no longer an allowed optional callback, instead a <code>framebuffer_resize</code> event was added.</li><li>A <code>.close</code> event was added which you should handle by e.g. <code>return true</code> to exit the program.</li><li>Some commonly used fields were renamed:<ul><li><code>core.swapchain</code> -> <code>core.swapchain()</code></li><li><code>core.swap_chain_format</code> -> <code>core.descriptor().format</code></li></ul></li></ul><h2 id=questions>Questions?</h2><p>Trouble updating, or have questions? We&rsquo;re always happy to help, feel free to <a href=../../../discord>join our Discord</a>!</p></div><div class=toc><h3>Table of contents</h3><nav id=TableOfContents><ul><li><a href=#updating-your-application>Updating your application</a></li><li><a href=#questions>Questions?</a></li></ul></nav></div></main><div class=footer><a href=https://hexops.com/privacy>Privacy matters</a><p><a href=https://github.com/hexops/machengine.org/archive/refs/heads/gh-pages.zip>offline version of this site</a> | <a href=https://machengine.org//about#improve-this-site>Improve this site</a> | <a href=https://github.com/sponsors/slimsag>Sponsor on GitHub</a> | <a href=https://devlog.hexops.com/>Hexops' devlog</a></p></div></div></body></html>